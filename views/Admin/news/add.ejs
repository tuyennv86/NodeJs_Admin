<!DOCTYPE html>
<html>
  <head>
    <% include ../../partials/backend/partialLink %>     
    <% include ../../partials/backend/partialCsript %>   
    <link rel="stylesheet" href="/jodit-3.3.8/jodit.min.css"/>
    <script src="/jodit-3.3.8/jodit.min.js"></script>      
  </head>
  <body> 
<% include ../../partials/backend/aside %> 
<div id="right-panel" class="right-panel">
<% include ../../partials/backend/header %>

<div class="breadcrumbs">
    <div class="col-sm-4">
        <div class="page-header float-left">
            <div class="page-title">
                <h1>Thêm mới bản tin</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-8">
        <div class="page-header float-right">
            <div class="page-title">
                <ol class="breadcrumb text-right">
                    <li><a href="index">Trang chủ</a></li> 
                    <li><a href="/admin/news/index">Danh sách bản tin</a></li>                 
                    <li class="active">Thêm mới bản tin</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div class="content mt-3">
    <div class="animated fadeIn">
         <div class="card">
                    <div class="card-header">
                <strong>Thêm mới bản tin</strong> 
            </div>
            <div class="card-body card-block">
            <% include ../../partials/backend/messages %>                       
                <form action="/admin/news/add" method="post" enctype="multipart/form-data" class="form-horizontal form-validate" id="ud">                    
                  
                    <div class="row form-group">
                        <div class="col col-md-3"><label for="parent" class="form-control-label">Danh mục tin :</label></div>
                        <div class="col-12 col-md-9 mserro">
                        <select name="slCategory" id="slCategory" class="form-control" data-placeholder="Chọn mục cha..." data-rule-required="true">
                            <%- include('../../partials/backend/dropallTree', {items: catedata, level: 1, id_check: 1 }) %>                          
                        <select>
                        </div>
                    </div>  
                    <div class="row form-group">
                        <div class="col col-md-3"><label class="form-control-label">Tên bản tin:</label></div>
                        <div class="col-12 col-md-9 mserro"><input type="text" id="Name" name="Name" placeholder="Nhập tên bản tin" class="form-control" data-rule-required="true"></div>
                    </div>
                    <div class="row form-group">
                        <div class="col col-md-3"><label class=" form-control-label">Tên Alias:</label></div>
                        <div class="col-12 col-md-9 mserro"><input type="text" id="newsKey" name="newsKey" placeholder="Nhập tên Alias" class="form-control"  data-rule-required="true"><span id="keyspan" style = "color:red;"><span></div>
                    </div>                  
                    
                    <div class="row form-group">
                        <div class="col col-md-3"><label class=" form-control-label">Meta Tile:</label></div>
                        <div class="col-12 col-md-9 mserro"><input type="text" id="metaTile" name="metaTile" placeholder="Nhập tên hiển thị cho Title" class="form-control"  data-rule-required="true"></div>
                    </div>
                    <div class="row form-group">
                        <div class="col col-md-3"><label class=" form-control-label">Meta Keyword:</label></div>
                        <div class="col-12 col-md-9 mserro"><input type="text" id="metaKeyword" name="metaKeyword" placeholder="Nhập keyword" class="form-control"  data-rule-required="true"></div>
                    </div>
                    <div class="row form-group">
                        <div class="col col-md-3"><label class=" form-control-label">Meta Description:</label></div>
                        <div class="col-12 col-md-9 mserro"><textarea  id="metaDescription" name="metaDescription" placeholder="Nhập Description" class="form-control"  data-rule-required="true" rows="2"></textarea></div>
                    </div>                   
                     <div class="row form-group">
                        <div class="col col-md-3"><label class=" form-control-label">Thứ tự</label></div>
                        <div class="col-12 col-md-9 mserro"><input type="text" id="order" name="order" placeholder="Nhập thứ tự sản phẩm" class="form-control" data-rule-required="true" data-rule-number="true"></div>
                    </div>            
                    <div class="row form-group">
                            <div class="col col-md-3"><label for="fileImg" class=" form-control-label">Chọn ảnh</label></div>
                            <div class="col-12 col-md-9 mserro"><input type="file" id="fileImg" name="fileImg" class="form-control-file" accept="image/*"></div>
                    </div>                   
                    <div class="row form-group">
                        <div class="col col-md-3"><label class=" form-control-label">Mô tả ngắn:</label></div>
                        <div class="col-12 col-md-9 mserro"><textarea id="preview" name="preview"  placeholder="Nhập mô tả ngắn" class="form-control" rows="3" cols="50"></textarea></div>
                    </div>
                    <div class="row form-group">
                        <div class="col col-md-3"><label class=" form-control-label">Chi tiết:</label></div>
                        <div class="col-12 col-md-9 mserro"><textarea id="detail" name="detail" placeholder="Nhập chi tiết" class="form-control" rows="4" cols="50"></textarea></div>
                    </div>                   
                    <div class="row form-group">
                        <div class="col col-md-3"><label class=" form-control-label">Vị trí :</label></div>
                        <div class="col-12 col-md-9 mserro">
                        <select name="slOption" id="slOption" class="form-control"  multiple="multiple" data-placeholder="Chọn vị trí">
                            <option value="1">Home</option>
                            <option value="2">Left</option>
                            <option value="3">Right</option>
                            <option value="4">Bottom</option>
                        <select>
                        </div>
                    </div> 
                    <div class="row form-group">
                        <div class="col col-md-3"> &nbsp; </div>
                            <div class="col col-md-9">
                                <div class="form-check">
                                    <div class="checkbox">
                                        <label for="chkActive" class="form-check-label ">
                                            <input type="checkbox" id="chkActive" name="chkActive" class="form-check-input"> Active
                                        </label>
                                    </div>                                                                     
                                </div>
                            </div>
                        </div>
                         <div class="row form-group">
                        <div class="col col-md-3">&nbsp;</div>
                        <div class="col-12 col-md-9"><button type="submit" id="bntAdd" class="btn btn-primary btn-sm"><i class="fa fa-plus-square-o"></i> Thêm mới</button>
                        <a href="/admin/news/index" class="btn btn-danger btn-sm"><i class="fa fa-reply"></i> Quay lại</a> </div>
                    </div> 
                    
                </form>
            </div>            
        </div>
    </div>
</div>

</div>

<script>
    var editor = new Jodit('#detail', {
        textIcons: false,
        iframe: false,
        iframeStyle: '*,.jodit_wysiwyg {color:red;}',
        height: 500,
        defaultMode: Jodit.MODE_WYSIWYG,
        observer: {
            timeout: 100
        },
        uploader: {
          insertImageAsBase64URI: true,
        },

        // uploader: {
        //    // url: 'https://xdsoft.net/jodit/connector/index.php?action=fileUpload'
        //    url: '/api/fileView/uploads'
        // },
        // filebrowser: {
        //     // buttons: ['list', 'tiles', 'sort'],
        //     ajax: {
        //         //url: 'https://xdsoft.net/jodit/connector/index.php'
        //         url: '/api/fileView/files'
        //     }
        // },
        commandToHotkeys: {
            'openreplacedialog': 'ctrl+p'
        }
        // buttons: ['symbol'],
        // disablePlugins: 'hotkeys,mobile'
    });
    var editor = new Jodit('#preview', {
        textIcons: false,
        iframe: false,
        iframeStyle: '*,.jodit_wysiwyg {color:red;}',
        height: 300,
        defaultMode: Jodit.MODE_WYSIWYG,
        observer: {
            timeout: 100
        },
        uploader: {
          insertImageAsBase64URI: true,
        },

        // uploader: {
        //    // url: 'https://xdsoft.net/jodit/connector/index.php?action=fileUpload'
        //    url: '/api/uploads'
        // },
        // filebrowser: {
        //     // buttons: ['list', 'tiles', 'sort'],
        //     ajax: {
        //         //url: 'https://xdsoft.net/jodit/connector/index.php'
        //         url: '/filebrowse/api/files'
        //     }
        // },
        commandToHotkeys: {
            'openreplacedialog': 'ctrl+p'
        }
        // buttons: ['symbol'],
        // disablePlugins: 'hotkeys,mobile'
    });
</script>


<script type="text/javascript">

    jQuery(document).ready(function($) {   
        
        $('#slCategory').select2();
        $("#slOption").select2({
            placeholder: 'Chọn các vị trí hiển thị',
            allowClear: true                          
        });

        $("#Name").bind("keyup", function (e) {
            var productName = $(this).val();
            $('#newsKey').val(getSeoTitle(productName));
            $('#metaTile').val(productName);
        });

        $("#Name").blur(function(){
            var catetext = $(this).val();
            $('#newsKey').val(getSeoTitle(catetext));
            $('#metaTile').val(catetext);
        });

        function checkExistProductKey(objId){
            $("#"+objId).blur(function(){
                $.ajax({
                    type: "GET",
                    async: true,        
                    url: "/api/news/checkExistKey/"+$("#newsKey").val(),        
                    cache: false,
                    dataType: "json",
                    success: function (done) {                
                        if(done.status){ 
                            $("#keyspan").html(done.message);    
                            $("#newsKey").focus();
                            $("#bntAdd").attr("disabled", true);
                            return false;
                        }else{
                            $("#keyspan").html('');    
                            $("#bntAdd").removeAttr("disabled");
                        }
                    }
                });
            });
        }
        checkExistProductKey("Name");
        checkExistProductKey("newsKey");   
    });
</script>


</body>
</html>