<!DOCTYPE html>
<html>
  <head>
    <% include ../../partials/backend/partialLink %> 
    <% include ../../partials/backend/partialCsript %>
  </head>
  <body> 
<% include ../../partials/backend/aside %> 
<div id="right-panel" class="right-panel">
<% include ../../partials/backend/header %>

<div class="breadcrumbs">
    <div class="col-sm-4">
        <div class="page-header float-left">
            <div class="page-title">
                <h1>Danh sách các sản phẩm</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-8">
        <div class="page-header float-right">
            <div class="page-title">
                <ol class="breadcrumb text-right">
                    <li><a href="index">Trang chủ</a></li>                  
                    <li class="active">Danh sách các sản phẩm</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div class="content mt-3">
    <div class="animated fadeIn">
            
         <div class="card">
                    <div class="card-header">
                        <div class="col col-md-6">                       
                         <form action="/admin/product/search" method="POST" class="form-horizontal">
                            <div class="input-group">
                                    <select class="form-control col-md-3 form-control-sm" id="slcate" name="slcate">
                                        <option value="1">Tất cả</option>
                                        <%- include('../../partials/backend/dropallTree', {items: listcate, level: 1, id_check: id_check }) %> 
                                    </select>
                                    <input type="text" class="form-control col-md-5 form-control-sm" name="textsearch" id="textsearch" placeholder="Nhập từ khóa tìm kiếm...">
                                    <span class="input-group-btn">
                                    <button class="btn btn-info btn-sm" type="submit"><i class="fa fa-search fa-fw"></i> Tìm kiếm</button>
                                    </span>
                            </div>
                        </form>  
                        </div>
                        <form action="/admin/product/index/<%= current %>" method="POST" class="form-horizontal" onSubmit="if(!confirm('Bạn có muốn xóa không?')){return false;}">
                        <div class="col-12 col-md-6">
                                <div class="float-right">
                                    <a href="/admin/product/add" class="btn btn-success btn-sm" style="color: #fff;">
                                        <i class="fa fa-plus"></i> Thêm mới
                                    </a>
                                    <button type="submit" class="btn btn-danger btn-sm" id="bntdeleteList" disabled>
                                            <i class="fa fa-trash-o"></i> Xóa sản phẩm được chọn
                                        </button>                                   
                                </div>
                        </div>
                        
                    </div>
                    <div class="card-body">
                     <% include ../../partials/backend/messages %>                       
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col"><input type="checkbox" id="checkAll"></th>
                                    <th scope="col" style="width:300px">Tên sản phẩm</th>
                                    <th scope="col">Ảnh</th>
                                    <th scope="col">Giá</th>                                   
                                    <th scope="col">Số lượng</th>
                                    <th scope="col">Lượt xem</th>
                                    <th scope="col">Thứ tự</th>
                                    <th scope="col">Active</th>
                                    <th scope="col">Home</th>
                                    <th scope="col">Ngày tạo</th>  
                                    <th scope="col">Người tạo</th>         
                                </tr>
                            </thead>
                            <tbody>
                           <% data.forEach(item => { %>
                             <tr>
                                    <td scope="row"><input type="checkbox" name="checkItem" class="checkItem" value="<%= item._id %>"></td>
                                    <td ><%= item.productName %><br>
                                    <a href="/admin/product/index?search=&cateid=<%= item.category._id %>"><%= item.category.categoryName %></a>
                                    </td>
                                    <td><% if(item.imageUrl != ''){%>
                                        <img src="<%= item.ImageUrlFull %>" class="align-self-center" alt="<%= item.productName %>" style="width:50px; height:50px;">
                                        <a class="showMore" href="#" title="Các ảnh khác"><i class="fa fa-eye-slash"></i></a>                                            
                                    <% } else { %>
                                        <img src="/images/noimg.jpg" class="align-self-center rounded-circle mr-3" alt="<%= item.productName %>" style="width:50px; height:50px;"> 
                                        <a class="showMore" href="#" title="Các ảnh khác"><i class="fa fa-eye-slash"></i></a>                                            
                                     <% } %></td>
                                    <td><span style="font-weight: bold; color: #ff0084;"> Giá : <%= item.priceFormat %> vnđ </span><br><span style="color:#0161a1;  text-decoration: line-through;">Giá cũ : <%= item.priceOldFormat %> vnđ</span></td>
                                    <td><input type="text" name="txtpageNumber" id="<%= item._id %>" value="<%= item.quantum %>" class="form-control" style="width:45px;"></td>
                                    <td> <%= item.viewCounts %> </td>
                                    <td><input type="text" name="txtpageNumber" id="<%= item._id %>" value="<%= item.order %>" class="form-control" style="width:45px;"></td>
                                    <td> <% if ( item.active) { %><span class="badge badge-success"><span class="ti-unlock"></span>&nbsp; Active</span>
                                     <% }else{%><span class="badge badge-danger"><span class="ti-lock"></span>&nbsp; Clock</span><%} %> </td>
                                    <td> <% if (item.home) { %>
                                    <span class="badge badge-success"><span class="ti-check-box"></span>&nbsp; Home</span>                                     
                                    <% } else{%><span class="badge badge-danger"><span class="ti-na"></span>&nbsp; Ẩn </span><%} %></td>
                                    <td><%= item.createDate_dd_mm_yyyy %></td>
                                    <td><%= item.createBy %></td>
                                    <td>
                                        <div class="float-right">
                                            <a class="btn btn-primary btn-sm" href="/admin/product/edit/<%= item._id %>?url=<%= linkUrl %>/<%= current %>"><i class="fa fa-wrench"></i>&nbsp; Sửa</a>
                                            <a class="btn btn-danger btn-sm" href="/admin/product/delete/<%= item._id %>?url=<%= linkUrl %>/<%= current %>" onclick="return confirm('Bạn có muốn xóa sản phẩm này không?');"><i class="fa fa-trash"></i>&nbsp; Xóa</a>
                                        </div>
                                    </td>
                                </tr>  
                                <% if(item.imageRelated.length > 0) {%> 
                                <tr style="display: none;">
                                    <td colspan="12">
                                        <% item.imageRelated.forEach(img =>{%>
                                            <img src="/uploads/pictures/<%= img %>" alt="<%= item.productName %>" width="30px" >      
                                        <%}) %>
                                        
                                    </td>         
                                </tr>   
                                <%}%>
                           <% }) %>
                                                          
                            </tbody>
                        </table>
                      <% include ../../partials/backend/PageNavigation %>
                    </div>                    
            </div>
            </form>
        </div>
    </div>
</div>

</div>
<script>
jQuery(document).ready(function($) {
   
    $(document).on("click", ".showMore", function() {
        event.preventDefault();     
       $(this).parent().parent().next().toggle();
    });

});

</script>
</body>
</html>